<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>—Å—Ç–∞–¥–∏ –≥–µ–π–º‚ú®</title>
    <style>
        :root { --accent: #a78bfa; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background: #020617;
            font-family: 'Segoe UI', sans-serif; user-select: none;
        }
        canvas { display: block; width: 100vw; height: 100vh; }

        /* –ò–ù–¢–ï–†–§–ï–ô–° */
        .overlay {
            position: fixed; inset: 0; display: flex; align-items: center; 
            justify-content: center; z-index: 1000;
            background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(15px);
        }
        .panel {
            background: rgba(255, 255, 255, 0.05); padding: 40px;
            border-radius: 30px; border: 1px solid rgba(255,255,255,0.1);
            text-align: center; color: white; width: 90%; max-width: 400px;
        }
        button.play-btn {
            width: 100%; padding: 20px; border: none; border-radius: 20px;
            background: var(--accent); color: white; font-weight: bold;
            font-size: 1.5rem; cursor: pointer; box-shadow: 0 0 25px rgba(167, 139, 250, 0.5);
        }

        /* –£–ü–†–ê–í–õ–ï–ù–ò–ï */
        .mobile-controls {
            position: fixed; bottom: 40px; left: 0; width: 100%;
            display: flex; justify-content: space-between; padding: 0 25px;
            z-index: 500; pointer-events: none;
        }
        .joy-side { display: flex; gap: 20px; pointer-events: auto; }
        .btn {
            width: 80px; height: 80px; background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.2); border-radius: 20px;
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 2rem; backdrop-filter: blur(8px);
        }
        .btn:active { background: var(--accent); transform: scale(0.9); }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <canvas id="game"></canvas>

    <div id="menu" class="overlay">
        <div class="panel">
            <h1 style="color: var(--accent); margin-bottom: 10px;">—Å—Ç–∞–¥–∏ –≥–µ–π–º‚ú®</h1>
            <p id="status" style="color: #94a3b8; margin-bottom: 30px;">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Å–æ –∑–≤—É–∫–æ–º</p>
            <button class="play-btn" id="startBtn">–ó–ê–ü–£–°–¢–ò–¢–¨ üéÆ</button>
        </div>
    </div>

    <div id="ui" class="mobile-controls hidden">
        <div class="joy-side">
            <div class="btn" id="lBtn">‚Üê</div>
            <div class="btn" id="rBtn">‚Üí</div>
        </div>
        <div class="joy-side">
            <div class="btn" id="jBtn">‚Üë</div>
        </div>
    </div>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    
    // –°–æ–∑–¥–∞–µ–º –∞—É–¥–∏–æ –æ–±—ä–µ–∫—Ç —á–µ—Ä–µ–∑ JS –¥–ª—è –ª—É—á—à–µ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
    const music = new Audio();
    music.src = 'music.mp3'; // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ü–ï–†–ï–ò–ú–ï–ù–£–ô –§–ê–ô–õ –í music.mp3
    music.loop = true;

    let isPlaying = false;
    let cameraX = 0;
    
    // –ò–≥—Ä–æ–∫ –∏ —É—Ä–æ–≤–Ω–∏
    const player = { x: 100, y: 300, w: 35, h: 35, vx: 0, vy: 0, speed: 7, jump: -17, ground: false };
    const input = { left: false, right: false, up: false };
    const level = { width: 3000, p: [[0, 550, 800, 100], [900, 400, 300, 20], [1300, 300, 400, 20], [1800, 450, 600, 20], [2500, 550, 500, 100]] };

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø–æ –∫–ª–∏–∫—É
    document.getElementById('startBtn').onclick = function() {
        // –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—å –º—É–∑—ã–∫—É –ø—Ä–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏
        music.play().then(() => {
            console.log("Music started");
            music.volume = 0.4;
        }).catch(err => {
            console.error("Audio error:", err);
            alert("–û—à–∏–±–∫–∞ –∞—É–¥–∏–æ: —É–±–µ–¥–∏—Å—å, —á—Ç–æ —Ñ–∞–π–ª –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è music.mp3 –∏ –ª–µ–∂–∏—Ç —Ä—è–¥–æ–º.");
        });

        document.getElementById('menu').classList.add('hidden');
        document.getElementById('ui').classList.remove('hidden');
        isPlaying = true;
        loop();
    };

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (Touch + Mouse)
    const setupBtn = (id, key) => {
        const el = document.getElementById(id);
        const start = (e) => { e.preventDefault(); input[key] = true; };
        const end = (e) => { e.preventDefault(); input[key] = false; };
        el.addEventListener('touchstart', start); el.addEventListener('touchend', end);
        el.addEventListener('mousedown', start); el.addEventListener('mouseup', end);
    };
    setupBtn('lBtn', 'left'); setupBtn('rBtn', 'right'); setupBtn('jBtn', 'up');

    function loop() {
        if(!isPlaying) return;

        // –§–∏–∑–∏–∫–∞
        if(input.left) player.vx = -player.speed;
        else if(input.right) player.vx = player.speed;
        else player.vx *= 0.85;

        if(input.up && player.ground) { player.vy = player.jump; player.ground = false; }
        player.vy += 0.8; player.x += player.vx; player.y += player.vy;

        // –ö–∞–º–µ—Ä–∞
        cameraX += (player.x - canvas.width/3 - cameraX) * 0.1;
        if(cameraX < 0) cameraX = 0;

        // –ö–æ–ª–ª–∏–∑–∏–∏
        player.ground = false;
        level.p.forEach(plat => {
            if(player.x < plat[0]+plat[2] && player.x+player.w > plat[0] && player.y+player.h > plat[1] && player.y+player.h < plat[1]+plat[3]+20 && player.vy >= 0) {
                player.y = plat[1]-player.h; player.vy = 0; player.ground = true;
            }
        });
        if(player.y > canvas.height + 200) { player.x = 100; player.y = 300; }

        // –†–∏—Å–æ–≤–∞–Ω–∏–µ
        ctx.fillStyle = '#020617';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.save();
        ctx.translate(-cameraX, 0);
        
        // –†–∏—Å—É–µ–º –æ–∫–Ω–∞ (—Ñ–æ–Ω)
        for(let i=0; i<10; i++) {
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(i*600 + 100, 100, 250, 350);
        }

        // –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã
        ctx.fillStyle = '#1e293b';
        level.p.forEach(plat => ctx.fillRect(plat[0], plat[1], plat[2], plat[3]));

        // –ò–≥—Ä–æ–∫
        ctx.fillStyle = '#f8fafc';
        ctx.shadowBlur = 15; ctx.shadowColor = '#a78bfa';
        ctx.fillRect(player.x, player.y, player.w, player.h);
        ctx.restore();

        requestAnimationFrame(loop);
    }
</script>
</body>
</html>
